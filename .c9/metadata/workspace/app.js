{"changed":true,"filter":false,"title":"app.js","tooltip":"/app.js","value":"var app = angular.module('myApp',['ui.router','ngToast','textAngular']);\n\napp.run(function($rootScope, AuthService,$state,$transitions){\n /*$rootScope.$on('$stateChangeStart',function(event, toState, toParams, fromState,fromParams){\n     if(toState.authenticate == true){\n         AuthService.isAuthenticated()\n         .then(function(res){\n             console.log(res);\n             if(res == false)\n                {\n                    $state.go('login');\n                }\n         });\n     }\n })\n});\n*/\n\n$transitions.onStart({}, function(transition){\n    if(transition.$to().self.authenticate == true){\n        AuthService.isAuthenticated()\n        .then(function(res){\n            console.log(res);\n            if (res == false) {\n                $state.go('login');\n            }\n        });\n    }\n})\n\n});\n\n\n\napp.config(function($stateProvider,$urlRouterProvider,$locationProvider){\n    Stamplay.init('premiumblogs');                                     // c9 change\n  // localStorage.removeItem(\"https://blogit-revo96.c9users.io-jwt\");        //c9 change\n  localStorage.clear();\n    $locationProvider.hashPrefix('');\n     $stateProvider\n    .state('home', {\n        url: '/',\n        templateUrl: 'template/home.html',\n        controller: \"HomeCtrl\"\n    })  \n    .state('login', {\n        url: '/login',\n        templateUrl: 'template/login.html',\n        controller: \"LoginCtrl\"\n    })\n    .state('signup', {\n        url: '/signup',\n        templateUrl: 'template/signup.html',\n        controller: \"SignUpCtrl\"\n    })\n    .state('MyBlogs',{\n        url: '/myBlogs',\n        templateUrl: 'template/myBlogs.html',\n        controller: 'MyBlogsCtrl',\n        authenticate: true\n    })\n    .state('Create',{\n        url: '/create',\n        templateUrl: 'template/create.html',\n        controller: 'CreateCtrl',\n        authenticate: true\n    })\n    .state('Edit',{\n        url: '/edit/:id',\n        templateUrl: 'template/edit.html',\n        controller: 'EditCtrl',\n        authenticate: true\n    })\n    .state('View', {\n        url: '/view/:id',\n        templateUrl: 'template/view.html',\n        controller: 'ViewCtrl'\n    });\n    \n    $urlRouterProvider.otherwise(\"/\");\n});\n\napp.filter('htmlToPlainText', function(){\n    return function(text){\n        return text ? String(text).replace(/<[^>]+>/gm, '') : '';\n    }\n});\n\napp.factory('AuthService', function($q, $rootScope){ \n    return { \n        isAuthenticated : function(){ \n            var defer = $q.defer();\n\n        Stamplay.User.currentUser(function(err, res){ \n            if(err){ \n                defer.resolve(false); \n                $rootScope.loggedIn = false; \n            }\n        else                        //my change\n        if(res.user){ \n            defer.resolve(true); \n            $rootScope.loggedIn = true;\n        }\n        else{ \n            defer.resolve(false); \n            $rootScope.loggedIn = false; \n        }\n    });\n    \n    return defer.promise;\n\n        }\n    }\n});\n\n\napp.controller('HomeCtrl',function($scope,$http){ \nStamplay.Object(\"blogs\").get({sort : \"-dt_create\"})\n.then(function(res){\n    console.log(res); \n    $scope.latestBlogs = res.data; \n    $scope.$apply(); \n    console.log($scope.latestBlogs); \n}, function(err){ \n    console.log(err); \n}); \n}) ; \n\n\n\napp.controller('MyBlogsCtrl',function($scope,$state){\nStamplay.User.currentUser().then(function(res){\n    if(res.user){                                               //JSON object as parameters. Two properties are owner & sort\n        Stamplay.Object(\"blogs\").get({owner: res.user._id, sort : \"-dt_create\"})    //get posts of user.\n        .then(function(response){\n            console.log(response);\n            $scope.userBlogs = response.data;\n            $scope.$apply();                // shall I not inject $appply.\n            console.log($scope.userBlogs);\n            }, function(err){\n             console.log(err); \n         });\n    }\n        else{                               // Go to login if not logged in.\n            $state.go('login');\n        }\n}, function(err){\n    console.log(err);\n});\n\n});\n\napp.controller('CreateCtrl',function(taOptions,$scope,$state, $timeout,ngToast){\n\n    $scope.newPost = {};\n\n taOptions.toolbar = [\n      ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'pre', 'quote'],\n      ['bold', 'italics', 'underline', 'strikeThrough', 'ul', 'ol', 'redo', 'undo', 'clear'],\n      ['justifyLeft', 'justifyCenter', 'justifyRight', 'indent', 'outdent'],\n      ['html', 'insertImage','insertLink', 'insertVideo', 'wordcount', 'charcount']\n  ];\n\n  $scope.create = function(){\n      Stamplay.User.currentUser()\n      .then(function(res){\n        if(res.user){\n            //proceed with post\n            Stamplay.Object(\"blogs\").save($scope.newPost)\n            .then(function(res){\n             $timeout(function(){\n                ngToast.create(\"Post created successfully\");\n            });\n            $state.go('MyBlogs');\n            },function(err){\n            $timeout(function(){\n            ngToast.create(\"An error occured while creating the post. Please try again later!\");\n            })\n            console.log(err);\n            })\n        }\n        else{\n            $state.go('login');\n        }\n      },function(err){\n            $timeout(function(){\n                ngToast.create(\"An error has occured. Please try again later!\");\n            })\n            console.log(err);\n      })\n  }\n\n});\n\napp.controller('EditCtrl',function(taOptions,$scope,$state,$stateParams, $timeout,ngToast){\n\n    $scope.Post = {};\n\n         taOptions.toolbar = [\n      ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'pre', 'quote'],\n      ['bold', 'italics', 'underline', 'strikeThrough', 'ul', 'ol', 'redo', 'undo', 'clear'],\n      ['justifyLeft', 'justifyCenter', 'justifyRight', 'indent', 'outdent'],\n      ['html', 'insertImage','insertLink', 'insertVideo', 'wordcount', 'charcount']\n  ];\n\n    Stamplay.Object(\"blogs\").get({_id: $stateParams.id})    //\n        .then(function(res){\n            console.log(res);\n            $scope.Post = res.data[0];\n            $scope.$apply();                // shall I not inject $appply.\n            console.log($scope.Post);\n            }, function(err){\n             console.log(err); \n         });\n    $scope.update = function(){\n        Stamplay.User.currentUser().then(function(res){ \n            if(res.user){\n                if(res.user._id == $scope.Post.owner){ \n                    Stamplay.Object(\"blogs\").update($stateParams.id, $scope.Post) \n                    .then(function(response){ \n                        console.log(response); \n                        $state.go(\"MyBlogs\"); \n                    }, function(error){ \n                        console.log(error); \n                    });\n                    } \n                else\n                        $state.go(\"login\"); \n                    }\n                    else \n                        $state.go(\"login\"); \n                    }, function(err){ \n                    console.log(err);\n                });\n    }\n});\n\napp.controller('ViewCtrl',function($scope,$stateParams,$timeout,$state,ngToast){\n\n//$scope.upVoteCount = 0; \n//$scope.downVoteCount = 5; \n\nStamplay.Object(\"blogs\").get({_id: $stateParams.id}) \n.then(function(response){ \n    console.log(response); \n    $scope.blog = response.data[0];\n    $scope.upVoteCount = $scope.blog.actions.votes.users_upvote.length;\n    $scope.downVoteCount = $scope.blog.actions.votes.users_downvote.length;  \n    $scope.$apply(); \n},function(error){\n    console.log(error); \n})\n\n$scope.postComment = function(){ \n    Stamplay.Object(\"blogs\").comment($stateParams.id, $scope.comment) \n    .then(function(res){ \n        console.log(res); \n        $scope.blog = res; \n        $scope.comment = \"\"; \n        $scope.$apply(); \n        },function(err){ \n            console.log(err); \n            if(err.code == 403){ \n                console.log(\"Login first!\"); \n                $timeout(function(){\n                    ngToast.create('<a href=\"#/login\" class=\"\">Please login before posting comments!.</a>'); \n                });\n            }\n        })\n}\n\n$scope.upVote = function(){\n    Stamplay.Object(\"blogs\").upVote($stateParams.id)\n    .then(function(res){\n        console.log(res); \n        $scope.blog = res; \n        $scope.comment = \"\"; \n        $scope.upVoteCount = $scope.blog.actions.votes.users_upvote.length;\n        $scope.downVoteCount = $scope.blog.actions.votes.users_downvote.length;\n        $scope.$apply(); \n    }, function(err){ \n        console. log(err); \n        if(err.code == 403){ \n            console.log(\"Login first!\"); \n            $timeout(function(){ \n                ngToast.create( '<a href=\"#/login\" class=\"\">Please login before voting.</a>' \n            ); \n        }); \n        }\n        if(err.code == 406){\n            console.log(\"Already Voted!\"); \n            $timeout(function(){ \n                ngToast.create('You have already voted on this Post.'); \n            }); \n        }\n    }) \n}\n\n$scope.downVote = function(){\n    Stamplay.Object(\"blogs\").downVote($stateParams.id)\n    .then(function(res){\n        console.log(res); \n        $scope.blog = res; \n        $scope.comment = \"\"; \n        $scope.upVoteCount = $scope.blog.actions.votes.users_upvote.length;               //shall this be included as well?\n        $scope.downVoteCount = $scope.blog.actions.votes.users_downvote.length; \n        $scope.$apply(); \n    }, function(err){ \n        console. log(err); \n        if(err.code == 403){ \n            console.log(\"Login first!\"); \n            $timeout(function(){ \n                ngToast.create( '<a href=\"#/login\" class=\"\">Please login before voting.</a>' \n            ); \n        }); \n        }\n        if(err.code == 406){\n            console.log(\"Already Voted!\"); \n            $timeout(function(){ \n                ngToast.create('You have already voted on this Post.'); \n            }); \n        }\n    }) \n}\n\n});\n\napp.controller('LoginCtrl',function($scope, $state, $timeout, $rootScope, ngToast){\n        $scope.login = function(){                  //UDF\n        Stamplay.User.currentUser()\n        .then(function(res){\n            console.log(res);\n            if(res.user){\n                $rootScope.loggedIn = true;\n                $rootScope.displayName = res.user.firstName+\" \"+res.user.lastName;\n                //user already logged in\n               $timeout(function(){ $state.go(\"MyBlogs\");\n            });\n            }\n            else{\n                //proceed with login\n                Stamplay.User.login($scope.User)            // Stamplay function\n                .then(function(res){  \n                    console.log(\"logged In as\" + res);\n                    $timeout(function(){\n                        ngToast.create(\"Login successful.\");\n                    })\n                    $rootScope.loggedIn = true;\n                    $rootScope.displayName = res.firstName+\" \"+res.lastName;\n                    $timeout(function(){ $state.go(\"MyBlogs\");\n            });\n                }, function(err){\n                    console.log(err);\n                    $rootScope.loggedIn = false;\n                      $timeout(function(){\n                        ngToast.create(\"Login failed!\");\n                    })\n                })\n            }\n        }, function(error){\n            console.log(error);\n              $timeout(function(){\n                        ngToast.create(\"An error has occured. Please try again later\");\n                    })\n        })\n    }\n});\n\napp.controller('SignUpCtrl',function($scope,ngToast,$timeout){\n    $scope.newUser = {};\n    $scope.signup = function(){\n        $scope.newUser.displayName = $scope.newUser.firstName + \" \" + $scope.newUser.lastName;\n\n      if($scope.newUser.firstName && $scope.newUser.lastName && $scope.newUser.email && $scope.newUser.password && $scope.newUser.confirmPassword)\n          {\n              console.log(\"All Fields are valid.\")\n              if($scope.newUser.password == $scope.newUser.confirmPassword){\n                  console.log('Ready to Sign Up');\n                //  $scope.newUser.fullName = $scope.newUser.firstName + ' ' + $scope.newUser.lastName;\n                //  console.log($scope.newUser.fullName + \" signed up !\");\n                  Stamplay.User.signup($scope.newUser)\n                  .then(function(response){\n                      $timeout(function(){ngToast.create(\"Your account has been created. Please login!\")});\n                      console.log(response);\n                  }, function(error){\n                      ngToast.create(\"An error has occured. Please try later.\")\n                      console.log(error);\n                  });\n              }\n                  else{\n                      ngToast.create(\"Passwords dont match\");\n                      console.log('Oops! Password doesnt match');}\n          }\n        else{ \n            ngToast.create(\"Some fields are invalid\");\n            console.log('Some fields are invalid');\n        }\n    };\n});\n\napp.controller('MainCtrl',function($scope,$rootScope,$timeout){\n$scope.logout = function(){\n    console.log(\"logout called\");\n    //localStorage.removeItem('https://blogit-revo96.c9users.io-jwt');               //c9 change\n    Stamplay.User.logout(true, function(){          // remove this\n        console.log(\"Logged Out!\");\n\n        $timeout(function(){\n            $rootScope.loggedIn = false;\n        })\n    })                          // and this line.\n}\n});\n","undoManager":{"mark":40,"position":50,"stack":[[{"start":{"row":36,"column":2},"end":{"row":36,"column":3},"action":"insert","lines":["/"],"id":279}],[{"start":{"row":36,"column":3},"end":{"row":36,"column":4},"action":"insert","lines":["/"],"id":280}],[{"start":{"row":36,"column":88},"end":{"row":37,"column":0},"action":"insert","lines":["",""],"id":281},{"start":{"row":37,"column":0},"end":{"row":37,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":37,"column":2},"end":{"row":37,"column":23},"action":"insert","lines":["localStorage.clear();"],"id":282}],[{"start":{"row":239,"column":0},"end":{"row":239,"column":1},"action":"insert","lines":["/"],"id":285}],[{"start":{"row":239,"column":1},"end":{"row":239,"column":2},"action":"insert","lines":["/"],"id":286}],[{"start":{"row":240,"column":0},"end":{"row":240,"column":1},"action":"insert","lines":["/"],"id":287}],[{"start":{"row":240,"column":1},"end":{"row":240,"column":2},"action":"insert","lines":["/"],"id":288}],[{"start":{"row":245,"column":32},"end":{"row":245,"column":33},"action":"remove","lines":["O"],"id":289}],[{"start":{"row":245,"column":32},"end":{"row":245,"column":33},"action":"insert","lines":["0"],"id":290}],[{"start":{"row":368,"column":51},"end":{"row":368,"column":52},"action":"insert","lines":[","],"id":291}],[{"start":{"row":368,"column":52},"end":{"row":368,"column":53},"action":"insert","lines":["$"],"id":292}],[{"start":{"row":368,"column":53},"end":{"row":368,"column":54},"action":"insert","lines":["t"],"id":293}],[{"start":{"row":368,"column":54},"end":{"row":368,"column":55},"action":"insert","lines":["i"],"id":294}],[{"start":{"row":368,"column":55},"end":{"row":368,"column":56},"action":"insert","lines":["m"],"id":295}],[{"start":{"row":368,"column":56},"end":{"row":368,"column":57},"action":"insert","lines":["e"],"id":296}],[{"start":{"row":368,"column":57},"end":{"row":368,"column":58},"action":"insert","lines":["o"],"id":297}],[{"start":{"row":368,"column":58},"end":{"row":368,"column":59},"action":"insert","lines":["u"],"id":298}],[{"start":{"row":368,"column":59},"end":{"row":368,"column":60},"action":"insert","lines":["t"],"id":299}],[{"start":{"row":382,"column":22},"end":{"row":382,"column":23},"action":"insert","lines":["$"],"id":300}],[{"start":{"row":382,"column":23},"end":{"row":382,"column":24},"action":"insert","lines":["t"],"id":301}],[{"start":{"row":382,"column":24},"end":{"row":382,"column":25},"action":"insert","lines":["i"],"id":302}],[{"start":{"row":382,"column":25},"end":{"row":382,"column":26},"action":"insert","lines":["m"],"id":303}],[{"start":{"row":382,"column":26},"end":{"row":382,"column":27},"action":"insert","lines":["e"],"id":304}],[{"start":{"row":382,"column":27},"end":{"row":382,"column":28},"action":"insert","lines":["o"],"id":305}],[{"start":{"row":382,"column":28},"end":{"row":382,"column":29},"action":"insert","lines":["u"],"id":306}],[{"start":{"row":382,"column":29},"end":{"row":382,"column":30},"action":"insert","lines":["t"],"id":307}],[{"start":{"row":382,"column":30},"end":{"row":382,"column":31},"action":"insert","lines":["("],"id":308}],[{"start":{"row":382,"column":31},"end":{"row":382,"column":32},"action":"insert","lines":["f"],"id":309}],[{"start":{"row":382,"column":32},"end":{"row":382,"column":33},"action":"insert","lines":["u"],"id":310}],[{"start":{"row":382,"column":33},"end":{"row":382,"column":34},"action":"insert","lines":["n"],"id":311}],[{"start":{"row":382,"column":34},"end":{"row":382,"column":35},"action":"insert","lines":["c"],"id":312}],[{"start":{"row":382,"column":31},"end":{"row":382,"column":35},"action":"remove","lines":["func"],"id":313},{"start":{"row":382,"column":31},"end":{"row":382,"column":39},"action":"insert","lines":["function"]}],[{"start":{"row":382,"column":39},"end":{"row":382,"column":40},"action":"insert","lines":["("],"id":314}],[{"start":{"row":382,"column":40},"end":{"row":382,"column":41},"action":"insert","lines":[")"],"id":315}],[{"start":{"row":382,"column":41},"end":{"row":382,"column":42},"action":"insert","lines":["{"],"id":316}],[{"start":{"row":382,"column":104},"end":{"row":382,"column":105},"action":"insert","lines":["}"],"id":317}],[{"start":{"row":382,"column":105},"end":{"row":382,"column":106},"action":"insert","lines":[")"],"id":318}],[{"start":{"row":382,"column":106},"end":{"row":382,"column":107},"action":"insert","lines":[";"],"id":319}],[{"start":{"row":341,"column":43},"end":{"row":341,"column":44},"action":"remove","lines":["u"],"id":320}],[{"start":{"row":341,"column":43},"end":{"row":341,"column":44},"action":"insert","lines":["U"],"id":321}],[{"start":{"row":35,"column":27},"end":{"row":35,"column":28},"action":"remove","lines":["t"],"id":322}],[{"start":{"row":35,"column":26},"end":{"row":35,"column":27},"action":"remove","lines":["i"],"id":323}],[{"start":{"row":35,"column":25},"end":{"row":35,"column":26},"action":"remove","lines":["g"],"id":324}],[{"start":{"row":35,"column":24},"end":{"row":35,"column":25},"action":"remove","lines":["o"],"id":325}],[{"start":{"row":35,"column":23},"end":{"row":35,"column":24},"action":"remove","lines":["l"],"id":326}],[{"start":{"row":35,"column":22},"end":{"row":35,"column":23},"action":"remove","lines":["b"],"id":327}],[{"start":{"row":35,"column":21},"end":{"row":35,"column":22},"action":"remove","lines":["g"],"id":328}],[{"start":{"row":35,"column":20},"end":{"row":35,"column":21},"action":"remove","lines":["r"],"id":329}],[{"start":{"row":35,"column":19},"end":{"row":35,"column":20},"action":"remove","lines":["o"],"id":330}],[{"start":{"row":35,"column":19},"end":{"row":35,"column":31},"action":"insert","lines":["premiumblogs"],"id":331}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":398,"column":3},"end":{"row":398,"column":3},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1501187198000}